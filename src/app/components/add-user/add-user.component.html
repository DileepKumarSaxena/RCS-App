<app-menu></app-menu> 
<div class="go-back-section template-back add-inner-padding">
    <div class="back-icon">
        <!-- <mat-icon matTooltip="Back" (click)="goBack()">arrow_back</mat-icon> -->
        <h5 class="text-center">{{heading}}</h5>
    </div>
</div>

<div _ngcontent-xvv-c46="" class="auth-bg min-vh-100 d-flex flex-column p-3 pt-2">
    <div _ngcontent-xvv-c46="" class="container p-0">
        <div _ngcontent-xvv-c46="" class="col-12 mt-4">
            <div _ngcontent-xvv-c46="" class="auth-section ms-auto ng-star-inserted card bg-light text-dark">

                <form _ngcontent-xvv-c46="" novalidate="" class="ng-pristine ng-invalid ng-touched"
                    [formGroup]="addUserForm" (ngSubmit)="onSubmit()">
                    <!-- <h1 _ngcontent-xvv-c46="" class="heading ml-0">New Account Setup</h1> -->
                    <p _ngcontent-xvv-c46="" class="sub-heading mb-4"></p>
                    <div _ngcontent-xvv-c46="" class="row ">
                        <div class="col-md-6 mt-2">

                            <div class="input-group mb-3">

                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-user"></i></span>

                                <input type="text" maxlength="20" minlength="3" formControlName="firstName"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.firstName.errors || f.firstName.errors?.minlength || f.firstName.errors?.maxlength) }"
                                    placeholder="First Name" class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.firstName.errors || f.firstName.errors?.minlength || f.firstName.errors?.maxlength)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.firstName.errors?.required">First Name is required</div>
                                    <div *ngIf="f.firstName.errors?.minlength">First Name should have at least 3
                                        characters</div>
                                    <div *ngIf="f.firstName.errors?.maxlength">First Name should have at most 20
                                        characters</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-user"></i></span>
                                <input type="text" maxlength="20" minlength="2" formControlName="lastName"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.lastName.errors || f.lastName.errors?.minlength || f.lastName.errors?.maxlength) }"
                                    placeholder="Last Name" class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.lastName.errors || f.lastName.errors?.minlength || f.lastName.errors?.maxlength)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.lastName.errors?.required">Last Name is required</div>
                                    <div *ngIf="f.lastName.errors?.minlength">Last Name should have at least 3
                                        characters</div>
                                    <div *ngIf="f.lastName.errors?.maxlength">Last Name should have at most 20
                                        characters</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-envelope"></i></span>
                                <input type="email" formControlName="email" maxlength="100" class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.email.errors || f.email.errors?.pattern) }"
                                    placeholder="Email" class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.email.errors || f.email.errors?.pattern)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.email.errors?.required">Email is required</div>
                                    <div *ngIf="f.email.errors?.pattern">Invalid email format</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-phone"></i></span>
                                <input type="tel" formControlName="phoneNumber" class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.phoneNumber.errors || f.phoneNumber.errors?.pattern) }"
                                    placeholder="Phone Number" class="form-control ps-0 ng-pristine ng-valid ng-touched"
                                    (input)="onPhoneNumberInput($event)" />
                                <div *ngIf="submitted && (f.phoneNumber.errors || f.phoneNumber.errors?.pattern)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.phoneNumber.errors?.required">Phone Number is required</div>
                                    <div *ngIf="f.phoneNumber.errors?.pattern">
                                        Phone Number must be a valid 10-digit number
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-lock"></i></span>
                                <input type="password" maxlength="30" formControlName="password" class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.password.errors || f.password.errors?.pattern) }"
                                    placeholder="Enter Password">
                                <div *ngIf="submitted && (f.password.errors || f.password.errors?.pattern)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.password.errors?.required">Password is required</div>
                                    <div *ngIf="f.password.errors?.pattern">Password must contain more than 8
                                        characters, 1 upper case letter, and 1 special character</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-lock"></i></span>
                                <input type="password" formControlName="confirmPassword"
                                    [ngClass]="{ 'is-invalid': submitted && (f.confirmPassword.errors || f.confirmPassword.errors?.mustMatch) }"
                                    class="form-control" placeholder="Confirm Password">
                                <div *ngIf="submitted && (f.confirmPassword.errors || f.confirmPassword.errors?.mustMatch)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.confirmPassword.errors?.required">Confirm Password is required</div>
                                    <div *ngIf="f.confirmPassword.errors?.mustMatch">Enter password was not matched
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-user"></i></span>
                                <input type="text" maxlength="20" minlength="3" formControlName="Username"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.Username.errors || f.Username.errors?.minlength || f.Username.errors?.maxlength) }"
                                    placeholder="Username" class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.Username.errors || f.Username.errors?.minlength || f.Username.errors?.maxlength || f.Username.errors?.noSpecialCharacters)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.Username.errors?.required">Username is required</div>
                                    <div *ngIf="f.Username.errors?.minlength">Username should have at least 3 characters
                                    </div>
                                    <div *ngIf="f.Username.errors?.maxlength">Username should have at most 20 characters
                                    </div>
                                    <div *ngIf="f.Username.errors?.noSpecialCharacters">Special characters are not
                                        allowed</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-user"></i></span>
                                <select style="width: 82%; padding: 1.3%;" formControlName="selectparentUser"
                                    class="form-select"
                                    [ngClass]="{ 'is-invalid': submitted && f.selectparentUser.invalid }"
                                    class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                    <option value="" disabled>Select Parent User</option>
                                    <option value="Admin">Admin</option>
                                </select>
                                <div *ngIf="submitted && f.selectparentUser.invalid" class="invalid-feedback">
                                    Parent User selection is required
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-id-badge"></i></span>
                                <input type="text" maxlength="100" minlength="3" formControlName="botId"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.botId.errors || f.botId.errors?.minlength || f.botId.errors?.maxlength) }"
                                    placeholder="Enter BotId" class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.botId.errors || f.botId.errors?.minlength || f.botId.errors?.maxlength)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.botId.errors?.required">BotId is required</div>
                                    <div *ngIf="f.botId.errors?.minlength">BotId should have at least 3
                                        characters</div>
                                    <div *ngIf="f.botId.errors?.maxlength">BotId should have at most 0
                                        characters</div>
                                    <div *ngIf="f.botId.errors?.noSpaces">Spaces are not allowed in BotId</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-id-badge"></i></span>
                                <input type="text" maxlength="200" minlength="3" formControlName="botToken"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.botToken.errors || f.botToken.errors?.minlength || f.botToken.errors?.maxlength) }"
                                    placeholder="Enter Bot Token"
                                    class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.botToken.errors || f.botToken.errors?.minlength || f.botToken.errors?.maxlength || f.botToken.errors?.noSpaces)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.botToken.errors?.required">Bot Token is required</div>
                                    <div *ngIf="f.botToken.errors?.minlength">Bot Token should have at least 3
                                        characters</div>
                                    <div *ngIf="f.botToken.errors?.maxlength">Bot Token should have at most 200
                                        characters</div>
                                    <div *ngIf="f.botToken.errors?.noSpaces">Spaces are not allowed in Bot Token</div>
                                </div>

                            </div>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-building"></i></span>
                                <div class="custom-file">
                                    <input type="file" formControlName="companyLogo" accept=".png, .jpg, .jpeg"
                                        class="custom-file-input" required (change)="handleCompanyLogoChange($event)">
                                    <label class="custom-file-label">{{ selectedFileName || 'Choose Company Logo'
                                        }}</label>
                                </div>
                            </div>
                            <p class="text-danger" style="margin-top: -10px;" *ngIf="logoError">{{ logoError }}</p>
                        </div>

                        <div class="col-md-6 mt-2">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-building"></i></span>
                                <div class="custom-file">
                                    <input type="file" formControlName="companyBanner" accept=".png, .jpg, .jpeg"
                                        class="custom-file-input" (change)="handleCompanyBannerChange($event)">
                                    <label class="custom-file-label">{{ selectedBannerName || 'Choose Company Banner'
                                        }}</label>
                                </div>
                            </div>
                            <p class="text-danger" style="margin-top: -10px;" *ngIf="bannerError">{{ bannerError }}</p>
                        </div>

                        <div _ngcontent-xvv-c46="" class="col-md-6 mt-3">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i aria-hidden="true" class="fa fa-building"></i></span>
                                <input type="text" maxlength="100" minlength="3" formControlName="companyName"
                                    class="form-control"
                                    [ngClass]="{ 'is-invalid': submitted && (f.companyName.errors || f.companyName.errors?.minlength || f.companyName.errors?.maxlength) }"
                                    placeholder="Company Name"
                                    class="form-control ps-0 ng-pristine ng-valid ng-touched">
                                <div *ngIf="submitted && (f.companyName.errors || f.companyName.errors?.minlength || f.companyName.errors?.maxlength)"
                                    class="invalid-feedback">
                                    <div *ngIf="f.companyName.errors?.required">Company Name is required</div>
                                    <div *ngIf="f.companyName.errors?.minlength">Company Name should have at least 3
                                        characters</div>
                                    <div *ngIf="f.companyName.errors?.maxlength">Company Name should have at most 100
                                        characters</div>
                                </div>
                            </div>
                        </div>

                        <div _ngcontent-xvv-c46="" class="col-md-6 mt-3">
                            <button _ngcontent-xvv-c46="" type="submit" class="w-100 shadow">
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                {{actionBtn}}
                            </button>
                            <br>
                            <div *ngIf="error" class="alert alert-danger mt-3 mb-0">{{error}}</div>
                        </div>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>